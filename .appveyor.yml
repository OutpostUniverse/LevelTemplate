image: Visual Studio 2017
configuration:
  - Release
  - Debug
install:
  - cd %APPVEYOR_BUILD_FOLDER%
  - git submodule update --init --recursive
build:
  project: OP2Script.sln
after_build:
  - set Version=Build%APPVEYOR_BUILD_VERSION%
  - if defined APPVEYOR_REPO_TAG_NAME set Version=%APPVEYOR_REPO_TAG_NAME%
  - set Config=%CONFIGURATION%
  - if defined PLATFORM set Config=%PLATFORM%-%Config%
  - set PackageBaseName="%APPVEYOR_PROJECT_NAME%-%Version%-%Config%"
  - set OutputFolder=%APPVEYOR_BUILD_FOLDER%\%PLATFORM%\%CONFIGURATION%\
  - if not exist "%OutputFolder%" set OutputFolder=%APPVEYOR_BUILD_FOLDER%\%CONFIGURATION%\
  - 7z a "%PackageBaseName%.zip" "%OutputFolder%*.dll"
  - 7z a "%PackageBaseName%-DebugSymbolPdb.zip" "%OutputFolder%*.pdb"
artifacts:
  - path: "*.zip"
    name: BuildArtifacts
deploy:
  on:
    branch: master
    APPVEYOR_REPO_TAG: true
  artifact: BuildArtifacts
  description: ''
  provider: GitHub
  auth_token:
    secure: TmV7XiO84JvSaLJnbrRrtoOugcFLSogA4I55yBZ1Y+QAmv28EOgO1M8lX+NSJWA/
